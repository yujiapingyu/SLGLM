# SLGLM
simple local glm（简单的本地GLM系统），可用于本地知识库的搭建
（模型下载下来后，纯本地运行，不需要访问远程API）

PS：langchain-glm的代码过于复杂和冗长，对于初学者不是很友好。本仓库的代码量不到200行，可以给初学者一些参考。

环境：python3.10.6
```
pip install requirement.txt
```

## 以医疗问答系统为例
### 1. 数据集
采用开源的医疗数据集（见参考内容），使用python的dataset库下载完毕后，进行数据的预处理：
```python
import datasets

knowledge_graph_dataset = datasets.load_dataset('FreedomIntelligence/huatuo_knowledge_graph_qa')
print(knowledge_graph_dataset['train'][0])

with open('medical_qs.txt', 'w') as f:
    for type_ in ['train', 'validation', 'test']:
        for item in knowledge_graph_dataset[type_]:
            q = '. '.join(item['questions'])
            a = '. '.join(item['answers'])
            f.write(f'Q: {q}  A: {a}\n\n')
```
### 2. 构建向量索引

修改src/knowledge_base.py的main函数：
```python
if __name__ == '__main__':
    knowledge_base = KnowledgeBase(EMBEDDING_MODEL)
    knowledge_base.load_doc_and_save_index('./data/test', './index', 'test')
    # knowledge_base.get_index_from_local('./index', 'medisian')
    print(knowledge_base.similarity_search('颈椎疼痛，手脚麻木怎么办'))
```
调用该脚本则可以创建本地索引，便于后续快速加载。

### 3. 启动问答系统
直接调用src/chat_bot.py的main函数即可。

### 关于模型的选择
1. embedding模型: GanymedeNil/text2vec-large-chinese
2. llm: THUDM/chatglm-6b

### 关于显存需求
15G左右，如果显存不够则考虑量化版本

### 原理
参考langchain-glm

### 演示
```bash
>>> 颈椎疼痛,身体麻木怎么办
我将给你一些文档内容以及来源，请你阅读并回答我的问题，你可以对文档进行总结，也可以加入自己已有的知识。答案不需要包含没用的话。
文档1: Q: 颈腰椎疾病的临床表现有些什么？  A: 肢体麻木；腰腿疼痛；颈部疼痛 
文档2: Q: 枢椎椎体骨折的症状是什么？  A: 剧烈疼痛；脊髓受压；颈部僵硬；颈部疼痛 
文档3: Q: 颈部疼痛的临床表现有些什么？  A: 肢体麻木无力 
文档4: Q: 颈肩综合征的临床表现有些什么？  A: 胀痛；功能障碍；疼痛；麻木；颈肩疼痛；颈肩部疼痛 
文档5: Q: 颈椎病的症状是什么？  A: 脖子扭痛；右腿麻木；颈心综合症；手臂发麻；肩背部沉重感；颈椎生理曲度变直；颈椎反弓；颈部疼痛；面部闪电疼痛；手脚发麻 
文档6: Q: 神经根型颈椎病会导致什么样的结果？  A: 颈痛；肩部疼痛；颈椎椎间孔狭窄；疼痛 
文档7: Q: 颈椎管硬膜下髓外肿瘤的临床表现有些什么？  A: 麻木；一侧上肢疼痛或麻木；下腰部疼痛；颈部疼痛 
文档8: Q: 上颈椎骨折及脱位的临床表现有些什么？  A: 四肢麻木无力；步态不稳；颈部疼痛 
文档9: Q: 颈椎骨性关节炎的临床表现有些什么？  A: 颈肩部麻木；颈肩部疼痛 
文档10: Q: 颈神经根性损害的临床表现有些什么？  A: 手无力；颈肩部疼痛；上肢痛麻痛感；上肢麻痛感 
我的问题是：颈椎疼痛,身体麻木怎么办

Medical小🐷手: 根据给出的文档，颈椎疼痛且身体麻木可能是由多种原因引起的，如椎间盘突出、颈椎管硬膜下髓外肿瘤、颈椎骨性关节炎、神经根型颈椎病等。针对这些情况，可以采取以下措施：

1. 休息：减少颈部的运动，让疼痛部位得到充分的休息，有助于减轻疼痛。

2. 物理疗法：通过按摩、牵引、热敷等方法，可以缓解颈椎疼痛和身体麻木。

3. 药物治疗：可以使用非甾体抗炎药物、镇痛剂等缓解疼痛和身体麻木。

4. 手术治疗：对于颈椎管硬膜下髓外肿瘤等严重疾病，可能需要手术治疗。

需要注意的是，对于颈椎疼痛和身体麻木的情况，应该尽快就医，接受专业医生的诊断和治疗。同时，日常保健中，应该注意颈椎的锻炼和保护，避免长时间保持同一姿势，避免颈部受伤。

>>> 右腿静脉曲张原因,怎么治疗
我将给你一些文档内容以及来源，请你阅读并回答我的问题，你可以对文档进行总结，也可以加入自己已有的知识。答案不需要包含没用的话。
文档1: Q: 下肢静脉曲张的发病部位是什么？  A: 下肢；大腿部位；小腿浅静脉区域；左髂总静脉 
文档2: Q: 单纯性下肢静脉曲张的治疗方式是什么？  A: 手术治疗 
文档3: Q: 静脉曲张的症状是什么？  A: 小腿和踝关节周；肢端溃疡；静脉出血；静脉曲张性溃疡 
文档4: Q: 小腿部曲张的手术治疗有些什么？  A: 大隐静脉剥脱 
文档5: Q: 静脉曲张伴交通支功能不全的手术治疗有些什么？  A: 小腿静脉交通支离断术 
文档6: Q: 单纯性下肢静脉曲张会导致什么样的结果？  A: 慢性下肢静脉曲张；下肢静脉曲张 
文档7: Q: 小腿曲张静脉的辅助治疗有些什么？  A: 激光治疗 
文档8: Q: 下肢静脉曲张伴交通支功能不全的手术治疗有些什么？  A: 内镜下小腿静脉交通支离断术 
文档9: Q: 下肢静脉曲张的简介是？  A: 下肢静脉曲张是一种常见疾病，尤其多见于从事持久体力劳动或站立工作的人员。主要表现为下肢表浅静脉扩张，伸长，迂曲，产生患肢酸胀，乏力，沉重等症状，严重者常伴有小腿溃疡或浅静脉炎等并发症。 
文档10: Q: 小腿动脉损伤的并发症是什么？  A: 下肢静脉曲张 
我的问题是：右腿静脉曲张原因,怎么治疗

Medical小🐷手: 根据您提供的文档，右腿静脉曲张的原因可能是长时间站立、从事持久体力劳动、静脉壁薄弱或静脉瓣缺陷等。对于治疗，手术治疗是单纯性下肢静脉曲张的常规方法，而大隐静脉剥脱术则是治疗单纯性下肢静脉曲张的一种手术方式。对于静脉曲张伴交通支功能不全的情况，手术治疗包括小腿静脉交通支离断术和内镜下小腿静脉交通支离断术。而辅助治疗则包括激光治疗。在治疗右腿静脉曲张时，可以考虑以上治疗方法，具体治疗方案还需根据您的实际情况进行选择。
```


## 参考内容
1. ChatGLM2-6b: https://huggingface.co/THUDM/chatglm2-6b
2. Langchain-GLM: https://github.com/imClumsyPanda/langchain-ChatGLM
3. Langchain: https://python.langchain.com/docs/get_started/introduction.html
3. 医疗数据集: https://github.com/FreedomIntelligence/Huatuo-26M